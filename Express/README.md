# Express

_Здавалося б, навіщо нам потрібен додатковий фреймворк, якщо ми можемо скористатися готовим модулем http, який є у Node.js API. Однак Express сам використовує модуль http, але водночас надає ряд готових абстракцій, які спрощують створення сервера та серверної логіки, зокрема обробка відправлених форм, робота з куками, CORS тощо._

* Вихідний код фреймворку: https://github.com/expressjs/express
* Установка у проєкті: `npm install express`

- - -

Для використання Express на початку треба створити об'єкт, який представлятиме додаток:
```javascript
  const app = express();
```

Для обробки запитів Express визначено ряд вбудованих функцій, і однією з таких є `app.get()`. Вона обробляє GET-запити протоколу HTTP та дозволяє пов'язати маршрути з певними обробниками. Для цього першим параметром передається маршрут, а другим - обробник, який буде викликатись, якщо запит до сервера відповідає даному маршруту.

```javascript
  app.get("/", function(request, response){     
      // відправляємо відповідь
      response.send("<h2>Привіт від Express!</h2>");
  });
```

> _І що важливо, Express спирається на систему маршрутів, тому всі інші запити, які не відповідають кореневому маршруту "/", не будуть оброблятися._

- - -

## Конвеєр обробки запиту та middleware

_Коли фреймворк Express отримує запит, цей запит передається до конвеєра обробки. Конвеєр складається з набору компонентів або middleware, які отримують дані запиту та вирішують, як його обробляти._

При необхідності ми можемо вбудувати конвеєр обробки запиту на будь-якому етапі будь-яку функцію middleware. Для цього використовується метод `app.use()`.

```javascript
  app.use(function(request, response, next){    
    console.log("виконується Middleware 1");
    next();
  });
```

Middleware допомагають виконувати деякі завдання, які мають бути зроблені до надсилання відповіді.\
Стандартне завдання – логування запитів.

```javascript
  // цей middleware виконується кожного разу при http-запиті
  app.use(function(request, response, next){     
    let now = new Date();
    let hour = now.getHours();
    let minutes = now.getMinutes();
    let seconds = now.getSeconds();
    let data = `${hour}:${minutes}:${seconds} ${request.method} ${request.url} ${request.get("user-agent")}`;
    console.log(data);
    fs.appendFile("server.log", data + "\n", function(){});
    next();
  });
```








